
{% block pagetitle %}Dashboard{% endblock pagetitle %}

{% block body %}
<style>
  /* Dashboard styling */
  .container-fluid {
    display: flex;
    height: 100vh;
  }
  .sidebar {
    width: 300px;
    background-color: #045403;
    color: white;
    padding-top: 20px;
    height: 100%;
    position: left;
  }
  .sidebar a {
    color: white;
    padding: 10px;
    display: block;
    text-decoration: none;
  }
  .sidebar a:hover {
    background-color: #007bff;
  }
  .content {
    margin-left: 220px; /* Adjust content to avoid overlap with sidebar */
    flex: 1;
    padding: 20px;
  }
  .chart-container {
    max-width: 500px;
    margin: auto;
  }
</style>

<div class="container-fluid">
  <!-- Sidebar -->
  <div class="sidebar">
    <h3>Dashboard</h3>
    <a href="/dashboard">Home</a>
    <a href="/settings">Settings</a>
    <a href ="/dashboard/index">AI ENGINE</a>
    <a href="/logout">Logout</a>
  </div>

  <!-- Content -->
  <div class="content">
    <h2 class="text-center">IoT Sensor Data</h2>

    <div class="chart-container">
      <h4>Soil Moisture: {{ sensor_data['soil_moisture'] }}%</h4>
      <canvas id="soilMoistureChart"></canvas>

      <h4>Temperature: {{ sensor_data['temperature'] }}Â°C</h4>
      <canvas id="temperatureChart"></canvas>
    </div>

    <!-- Water Pump Control -->
    <div class="mt-5 text-center">
      <h4>Water Pump</h4>
      <button class="btn btn-{{ 'success' if pump_status else 'danger' }}" onclick="togglePump()">
        {{ 'Turn Off' if pump_status else 'Turn On' }}
      </button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Chart.js code for soil moisture and temperature charts
  const soilMoistureChart = new Chart(document.getElementById('soilMoistureChart'), {
    type: 'doughnut',
    data: {
      labels: ['Moisture', 'Dryness'],
      datasets: [{
        data: [{{ sensor_data['soil_moisture'] }}, {{ 100 - sensor_data['soil_moisture'] }}],
        backgroundColor: ['#4CAF50', '#d9534f']
      }]
    }
  });

  const temperatureChart = new Chart(document.getElementById('temperatureChart'), {
    type: 'doughnut',
    data: {
      labels: ['Temperature', 'Remaining'],
      datasets: [{
        data: [{{ sensor_data['temperature'] }}, {{ 100 - sensor_data['temperature'] }}],
        backgroundColor: ['#f39c12', '#d9534f']
      }]
    }
  });

  // Toggle Pump Status
  function togglePump() {
    fetch('/toggle_pump', { method: 'POST' })
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          location.reload(); // Reload the page to reflect the updated pump status
        } else {
          alert('Error toggling pump');
        }
      })
      .catch(error => console.error('Error:', error));
  }
</script>
{% endblock body %}
